name: "Terraform Multi-Stage Pipeline"

on:
  push:
    branches:
      - feature
      - qa
      - main

jobs:
  feature:
    if: startsWith(github.ref, 'refs/heads/feature')
    runs-on: self-hosted
    defaults:
      run:
        working-directory: environment/dev
    steps:
      # Step 1: Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Azure Login (using secrets)
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_SECRET_ID }}

      # Step 3: Terraform Init (dev backend)
      - name: Terraform Init
        run: terraform init -backend-config="terraform.tfvars"

      # Step 4: Terraform Plan
      - name: Terraform Plan (Feature)
        run: terraform plan -var-file="terraform.tfvars"


      

      
     

